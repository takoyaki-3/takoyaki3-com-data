# たこやきさんの鯖構成

たこやきさんの運営しているサービスは次のようなサーバーは次のような構成で稼働しています。

![](https://pages.api.takoyaki3.com/pages/network.png)

## リバースプロキシ

各ドメインにアクセスされると最初にリバースプロキシへ飛ばされます。リバースプロキシでSSLを用いた暗号化を行い、Dockerコンテナで稼働する各サービスへリダイレクトします。なお、リバースプロキシ自体もDockerコンテナとして動いています。リバースプロキシにはCaddyを利用しています。

## Webサーバー

ファイルを出力するだけのWebサーバーの場合、Webサーバーコンテナがファイルを出力しています。なお、更新頻度の低いファイルに関しては、VPS上のファイルでなくCloudflareのR2ストレージに保存されているファイルを参照して出力するため、VPS上にファイルをホストせず、VPSのストレージを有効利用しています。この際、大量に存在するファイルの場合、オブジェクトストレージ上にすべて格納すると初期保存時やデータアップデート時にオペレーションコストがかさむため、ファイル名のハッシュ値毎にまとめ、tar.gzファイルとしてオブジェクトストレージ上に保存しています。

## APIサーバー

GolangやNode.js、Pythonにより構築したAPIサーバーをDockerコンテナでホストしています。